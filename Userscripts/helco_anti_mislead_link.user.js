// ==UserScript==
// @name         Anti Misleading Links
// @version      0.2
// @description  Pause links that take you places that don't visually match. (Can work for other websites if you know how it works)
// @author       Helcostr [1934501]
// @match        https://www.torn.com/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';
    const domains = [".com",".org",".net",".int",".edu",".gov",".mil",".arpa",".de",".ac",".ac.uk",".ac.in",".ac.id",".ad",".ae",".af",".ag",".ai",".al",".am",".ao",".aq",".ar",".as",".at",".au",".aw",".ax",".az",".ba",".bb",".bd",".be",".bf",".bg",".бг",".bh",".bi",".bj",".bm",".bn",".bo",".br",".bs",".bt",".bw",".by",".bz",".st",".ca",".cc",".cd",".cf",".cg",".ch",".ci",".ck",".cl",".cm",".cn",".co",".cr",".cu",".cv",".cw",".cx",".cy",".cz",".de",".dj",".dk",".dm",".do",".dz",".ec",".ee",".eg",".er",".es",".et",".eu",".eus",".fi",".fj",".fk",".fm",".fo",".fr",".ga",".gd",".ge",".gf",".gg",".gh",".gi",".gl",".gal",".gm",".gn",".gp",".gq",".gr",".gs",".gt",".gu",".gw",".gy",".hk",".hm",".hn",".hr",".ht",".hu",".id",".ie",".il",".im",".in",".io",".iq",".ir",".is",".it",".je",".jm",".jo",".jp",".ke",".kg",".kh",".ki",".km",".kn",".kp",".kr",".kw",".ky",".kz",".la",".lb",".lc",".li",".lk",".lr",".ls",".lt",".lu",".lv",".ly",".ma",".mc",".md",".me",".mg",".mh",".mk",".ml",".mm",".mn",".mn",".mo",".mp",".mq",".mr",".ms",".mt",".mu",".mv",".mw",".mx",".my",".mz",".na",".nc",".ne",".nf",".ng",".ni",".nl",".no",".np",".nr",".nu",".nz",".om",".pa",".pe",".pf",".pg",".ph",".pk",".pl",".pm",".pn",".pr",".ps",".pt",".pw",".py",".qa",".re",".ro",".rs",".ru",".su",".рф",".rw",".sa",".sb",".sc",".sd",".se",".sg",".sh",".si",".sk",".sl",".sm",".sn",".so",".sr",".ss",".st",".bz",".su",".sv",".sx",".sy",".sz",".tc",".td",".tf",".tg",".th",".tj",".tk",".tl",".tp",".tm",".tn",".to",".tr",".tt",".tv",".tw",".tz",".ua",".ug",".uk",".us",".gov",".uy",".uz",".va",".vc",".ve",".vg",".vi",".vn",".vu",".wf",".ws",".ye",".yt",".za",".zm",".zw",".zm",".الجزائر",".dz",".հայ",".am",".البحرين",".bh",".বাংলা",".bd",".бел",".by",".бг",".bg",".中国",".cn",".中國",".cn",".eg",".ею",".eu",".ευ",".eu",".გე",".ge",".ελ",".gr",".香港",".hk",".भारत",".in",".بھارت",".in",".భారత్",".in",".ભારત",".in",".ਭਾਰਤ",".in",".இந்தியா",".in",".ভারত",".in",".ಭಾರತ",".in",".ഭാരതം",".in",".ভাৰত",".in",".ଭାରତ",".in",".بارت",".in",".भारतम्",".in",".भारोत",".in",".ڀارت",".in",".ایران",".ir",".عراق",".iq",".الاردن",".jo",".қаз",".kz",".ລາວ",".la",".澳门",".mo",".澳門",".mo",".مليسيا",".my",".موريتانيا",".mr",".мон",".mn",".المغرب",".ma",".мкд",".mk",".عمان",".om",".پاکستان",".pk",".فلسطين",".ps",".قطر",".qa",".рф",".ru",".sa",".срб",".rs",".新加坡",".sg",".சிங்கப்பூர்",".sg",".한국",".kr",".ලංකා",".lk",".இலங்கை",".lk",".sd",".سورية",".sy",".台湾",".tw",".台灣",".tw",".ไทย",".th",".tn",".укр",".ua",".ae",".اليمن",".ye",".academy",".accountant",".accountants",".active",".actor",".ads",".adult",".aero",".africa",".agency",".airforce",".amazon",".analytics",".apartments",".app",".archi",".army",".art",".associates",".attorney",".auction",".audible",".audio",".author",".auto",".autos",".aws",".baby",".band",".bank",".bar",".barefoot",".bargains",".baseball",".basketball",".beauty",".beer",".berlin",".best",".bestbuy",".bet",".bible",".bid",".bike",".bingo",".bio",".biz",".black",".blackfriday",".blockbuster",".blog",".blue",".boo",".book",".boots",".bot",".boutique",".box",".broadway",".broker",".build",".builders",".business",".buy",".buzz",".cab",".cafe",".call",".cam",".camera",".camp",".cancerresearch",".capital",".car",".cards",".care",".career",".careers",".cars",".case",".cash",".casino",".catering",".catholic",".center",".cern",".ceo",".cfd",".channel",".chat",".cheap",".christmas",".church",".cipriani",".circle",".city",".claims",".cleaning",".click",".clinic",".clothing",".cloud",".club",".coach",".codes",".coffee",".college",".community",".company",".compare",".computer",".condos",".construction",".consulting",".contact",".contractors",".cooking",".cool",".coop",".country",".coupon",".coupons",".courses",".credit",".creditcard",".cruise",".cricket",".cruises",".dad",".dance",".date",".dating",".day",".deal",".deals",".degree",".delivery",".democrat",".dental",".dentist",".design",".dev",".diamonds",".diet",".digital",".direct",".directory",".discount",".diy",".docs",".doctor",".dog",".domains",".dot",".download",".drive",".duck",".earth",".eat",".eco",".education",".email",".energy",".engineer",".engineering",".edeka",".enterprises",".equipment",".esq",".estate",".events",".exchange",".expert",".exposed",".express",".fail",".faith",".family",".fan",".fans",".farm",".fashion",".fast",".feedback",".film",".final",".finance",".financial",".fire",".fish",".fishing",".fit",".fitness",".flights",".florist",".flowers",".fly",".foo",".food",".foodnetwork",".football",".forsale",".forum",".foundation",".free",".frontdoor",".fun",".fund",".furniture",".futbol",".fyi",".gallery",".game",".games",".garden",".gay",".gdn",".gift",".gifts",".gives",".glass",".global",".gold",".golf",".google",".gop",".graphics",".green",".gripe",".grocery",".group",".guide",".guitars",".guru",".hair",".hangout",".health",".healthcare",".help",".here",".hiphop",".hiv",".hockey",".holdings",".holiday",".homegoods",".homes",".homesense",".horse",".hospital",".hosting",".hot",".hotels",".house",".how",".ice",".industries",".info",".ing",".ink",".institute",".insurance",".insure",".international",".investments",".jewelry",".jobs",".joy",".kim",".kitchen",".land",".latino",".law",".lawyer",".lease",".legal",".lgbt",".life",".lifeinsurance",".lighting",".like",".limited",".limo",".link",".living",".loan",".loans",".locker",".lol",".lotto",".love",".ltd",".luxury",".makeup",".management",".market",".marketing",".markets",".mba",".med",".media",".meet",".meme",".memorial",".menu",".mint",".mobi",".mobile",".mobily",".moe",".mom",".money",".monster",".mortgage",".motorcycles",".mov",".movie",".museum",".music",".name",".navy",".network",".news",".ngo",".now",".ntt",".observer",".off",".org",".one",".one (top-level domain)",".ong",".onl",".online",".ooo",".open",".organic",".origins",".page",".partners",".parts",".party",".pay",".pet",".pharmacy",".phone",".photo",".photography",".photos",".physio",".pics",".pictures",".pid",".pin",".pink",".pizza",".place",".plumbing",".plus",".poker",".porn",".post",".press",".prime",".pro",".productions",".prof",".promo",".properties",".property",".protection",".qpon",".racing",".radio",".read",".realestate",".realtor",".realty",".recipes",".rehab",".reit",".rent",".rentals",".repair",".report",".republican",".rest",".restaurant",".review",".reviews",".rich",".rip",".rocks",".rodeo",".room",".rugby",".run",".safe",".sale",".save",".sbi",".scholarships",".school",".science",".search",".secure",".security",".select",".services",".sex",".sexy",".shoes",".shop",".shopping",".show",".showtime",".silk",".singles",".site",".ski",".skin",".sky",".sling",".smile",".soccer",".social",".software",".solar",".solutions",".song",".space",".spot",".spreadbetting",".storage",".store",".stream",".studio",".study",".style",".sucks",".supplies",".supply",".support",".surf",".surgery",".systems",".talk",".tattoo",".tax",".taxi",".team",".tech",".technology",".tel",".tennis",".theater",".theatre",".tickets",".tips",".tires",".today",".tools",".top",".tours",".town",".toys",".trade",".trading",".training",".travel",".travelersinsurance",".trust",".tube",".tunes",".uconnect",".university",".vacations",".ventures",".vet",".video",".villas",".vip",".vision",".vodka",".vote",".voting",".voyage",".wang",".watch",".watches",".weather",".webcam",".website",".wed",".wedding",".whoswho",".wiki",".win",".wine",".winners",".work",".works",".world",".wow",".wtf",".xxx",".xyz",".yachts",".yoga",".you",".zero",".zone",".ren",".shouji",".tushu",".wanggou",".weibo",".xihuan",".xin",".arte",".clinique",".luxe",".maison",".moi",".rsvp",".sarl",".epost",".gmbh",".haus",".immobilien",".jetzt",".kaufen",".kinder",".reise",".reisen",".schule",".versicherung",".desi",".shiksha",".casa",".immo",".moda",".voto",".bom",".passagens",".abogado",".futbol",".gratis",".hoteles",".juegos",".ltda",".soy",".tienda",".uno",".viajes",".vuelos",".موقع",".شبكة",".بازار",".网址",".网站",".网络",".公司",".商城",".机构",".我爱你",".商标",".世界",".集团",".慈善",".八卦",".公益",".дети",".ком",".онлайн",".орг",".сайт",".संगठन",".कॉम",".नेट",".닷컴",".닷넷",".קום",".みんな",".セール",".ファッション",".ストア",".ポイント",".クラウド",".คอม",".africa",".capetown",".durban",".joburg",".abudhabi",".arab",".asia",".doha",".dubai",".krd",".kyoto",".nagoya",".okinawa",".osaka",".ryukyu",".taipei",".tatar",".tokyo",".yokohama",".alsace",".amsterdam",".bar",".bcn",".barcelona",".bayern",".berlin",".brussels",".budapest",".bzh",".cat",".cologne",".corsica",".cymru",".eus",".frl",".gal",".gent",".hamburg",".helsinki",".irish",".ist",".istanbul",".koeln",".london",".madrid",".moscow",".nrw",".paris",".ruhr",".saarland",".scot",".stockholm",".swiss",".tirol",".wales",".wien",".zuerich",".boston",".miami",".nyc",".quebec",".vegas",".kiwi",".melbourne",".sydney",".lat",".rio",".佛山",".москва",".moscow",".рус",".ru",".рф",".aaa",".abarth",".abb",".abc",".aeg",".afl",".aig",".airtel",".americanexpress",".bananarepublic",".bbc",".bentley",".example",".invalid",".local",".localhost",".onion",".test",".app",".bar",".bible",".biz",".cern",".church",".cloud",".club",".college",".com",".design",".dev",".eco",".green",".hiv",".info",".kaufen",".kiwi",".lat",".lgbt",".name",".mobi",".moe",".net",".ngo",".one",".ong",".ooo",".org",".pro",".shop",".wiki",".wtf",".xyz",".aero",".asia",".cat",".coop",".edu",".google",".gov",".int",".jobs",".mil",".museum",".post",".tel",".travel",".xxx",".africa",".amsterdam",".bcn",".berlin",".brussels",".bzh",".cymru",".eu",".eus",".frl",".gal",".gent",".irish",".ist",".istanbul",".kiwi",".krd",".lat",".london",".melbourne",".nyc",".paris",".quebec",".rio",".saarland",".scot",".sydney",".taipei",".tokyo",".vegas",".vlaanderen",".wales",".wien",".arpa",".nato",".example",".invalid",".local",".localhost",".onion",".test",".eng",".sic",".geo",".mail",".web",".kid",".kids",".music"]
    const anchClick = function(){
        let focus = $(this);
        if (validURL(focus.text())) {
            console.log(focus);
            let href = new URL(focus.attr("href"),location.origin);
            let text = (domains.findIndex(dom=>focus.text().toLowerCase().includes(dom)) != -1 && !focus.text().toLowerCase().startsWith("http"))?new URL("http://"+focus.text()):new URL(focus.text(),location.origin);
            if (href.host+href.pathname != text.host+text.pathname && !confirm("Would you like to navigate to:\n" + focus.attr("href")))
                return false;
        }
    };
    const mutationEach = e=>{
        if (e.tagName=="A") {
            $(e).on('click',anchClick);
        }
    }
    // Create an observer instance linked to the callback function
    const observer = new MutationObserver(list=>{
        for(let mutation of list) {
            mutation.addedNodes.forEach(mutationEach);
        }
    });

    // Start observing the target node for configured mutations
    observer.observe(document, { childList: true, subtree: true });
    $('a').on('click',anchClick);

    function validURL(str) {
        for (let domain of domains) {
            if (str.includes(domain))
                return true;
        }
        return false;
    }
})();
